05_02 스프링 부트 2.0 기반의 OAuth2 설정
=======================

# 스프링 부트 2.0 기반의 OAuth2 설정
스프링 부트 2.0 버전에서부터는 시큐리티와 OAuth2 인증 부분에 많은 변화가 생겼습니다.   
기존 1.5 버전 코드에서 업그레이드 하면서 알아봅시다.   

# 1. 스프링 부트 2.0 버전으로 의존성 업그레이드      
스프링 부트의 장점은 빠른 버전 업그레이드가 가능하다는 것 입니다.    
기존의 ```build.gradle``` 파일에서 ```springBootVersion = '1.5.14.RELEASE'``` 에서 버전만 바꿔주면 됩니다.    

**build.gradle**   
```gradle
buildscript {
	ext{
		springBootVersion = '2.0.3.RELEASE'
	}
	repositories {
		mavenCentral()
		jcenter()
	}
	dependencies {
		classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
	}
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'org.springframework.boot'
apply plugin: 'io.spring.dependency-management'

group = 'com.web'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = 1.8

.
. ~ 생략 ~ 
.  
``` 
```gradle
		springBootVersion = '2.0.3.RELEASE'
```
스프링 부트 버전을 2.0.3 RELEASE 로 수정했습니다.     
     
```gradle
apply plugin: 'io.spring.dependency-management'
```
2.0 이후부터는 더 이상 ```dependency-management``` 플러그인을 자동으로 지원하지 않기 때문에 수동으로 추가해줘야 합니다.            
```dependency-management``` 플러그인은 그레이들에서 의존성 관리 제어를 위해 필요한 플러그인입니다.         
    
___      
    
이번에는 라이브러리 의존성들을 2.0 버전에 맞춰서 업그레이드 시켜주겠습니다. (버전이 아닌 필요 라이브러리 변경)    

**build.gradle**   
```gradle   
.
. ~ 생략 ~ 
.
dependencies {
	compile('org.springframework.security:spring-security-oauth2-client')
	compile('org.springframework.security:spring-security-oauth2-jose')
	compile('org.springframework.boot:spring-boot-starter-security')
	compile('org.springframework.boot:spring-boot-starter-web')
	compile('org.springframework.boot:spring-boot-starter-thymeleaf')
	compile('org.springframework.boot:spring-boot-starter-data-jpa')
	runtime('com.h2database:h2')
	runtime('org.springframework.boot:spring-boot-devtools')
	compileOnly('org.projectlombok:lombok')
	testCompile('org.springframework.boot:spring-boot-starter-test')
}
.
. ~ 생략 ~ 
.
```
기존에는 ```compile('org.springframework.security.oauth:spring-security-oauth2')``` 가 있으면 괜찮았지만      
2.0 으로 넘어오고 나서는 설정이 세분화 되었습니다.              
기본적인 OAuth2 인증 관련 객체들이 시큐리티로 이전되었습니다.       
   
* 2.0 에서는 **클라이언트 자동 인증 설정**을 위해 ```spring-security-oauth2-client``` 를 추가합니다.          
* 2.0 에서는 **JWT 와 관련한 권한을 안전하게 전송**하기 위한 프레임 워크인 ```JOSE```가 추가되었습니다.            
JWT에는 자신의 리소스에 접근할 수 있는 권한 정보가 들어있는데 JOSE는 JWT의 암호화/복호화 및 일정한 기능을 제공합니다.        

```
1.5 버전에서는 타임리프에 spring-boot-starter-web 에 대한 설정도 포함되어 있었지만 2.0 부터는 포함되지 않아 추가했습니다.    
또한 2.0 부터는 타임리프의 java8time 설정이 타임리프 스타터 설정에 포함되었기 떼문에 제거했습니다.   
- 필자 정리를 보신분들은 의아하실 수 있는데 저는 애초에 starter 로 해서 해당 내용이 없습니다.    
```

**전체 build.gradle**
```gradle
buildscript {
	ext{
		springBootVersion = '2.0.3.RELEASE'
	}
	repositories {
		mavenCentral()
		jcenter()
	}
	dependencies {
		classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
	}
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'org.springframework.boot'
apply plugin: 'io.spring.dependency-management'

group = 'com.web'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = 1.8

repositories {
	mavenCentral()
	jcenter()
}

dependencies {
	compile('org.springframework.security:spring-security-oauth2-client')
	compile('org.springframework.security:spring-security-oauth2-jose')
	compile('org.springframework.boot:spring-boot-starter-security')
	compile('org.springframework.boot:spring-boot-starter-web')
	compile('org.springframework.boot:spring-boot-starter-thymeleaf')
	compile('org.springframework.boot:spring-boot-starter-data-jpa')
	runtime('com.h2database:h2')
	runtime('org.springframework.boot:spring-boot-devtools')
	compileOnly('org.projectlombok:lombok')
	testCompile('org.springframework.boot:spring-boot-starter-test')
}

test {
	useJUnitPlatform()
}    
```

# 2. 스프링 부트 2.0 방식의 OAuth2 인증 재설정    
2.0 버전으로 라이브러리들을 변경해주었기 때문에 기존 코드들에 많은 부분이 에러가 나게 될 것입니다.       
그렇기에 이제 기존 코드를 2.0 버전에 맞춰서 변경해주는 작업을 진행해주갰습니다.         
    
**먼저 2.0 버전에서 제거된 객체를 삭제하겠습니다.**     
```spring-security-oauth2``` 를 의존성 제거했기 대문에 다음의 관련 객체들을 삭제합니다.   
```   
/com/web/oauth/ClientResources.java
/com/web/oauth/UserTokenService.java   
```    
이제 새롭게 소셜 정보를 제공해줄 객체를 생성하겠습니다.    
시큐리티의 OAuth2 스펙에서는 여러 소셜 정보를 기본값으로 제공해주고 있습니다.      

```org.springframework.security:spring-security-config:5.0.6.RELEASE``` 라이브러리의 
```org.springframework.security.config.oauth2.client``` 디렉토리의 ```CommonOAuth2Provider``` enum 을 살펴봅시다   

**CommonOAuth2Provider**


```
내용1
```
## 1.2. 소 주제
### 1.2.1. 내용1
```
내용1
```

***
# 2. 대주제
> 인용
## 2.1. 소 주제
### 2.1.1. 내용1
```
내용1
```   

***
# 3. 대주제
> 인용
## 3.1. 소 주제
### 3.1.1. 내용1
```
내용1
```
