
02 스프링부트 환경 설정
=======================

# 1. JDK 설치


***
# 2. 인텔리제이 IDEA 사용하기  
## 2.1. 커뮤니티 버전과 얼티미트 버전   
## 2.2. 커뮤니티 버전에서 스프링 부트 사용하기 
```java
package community.community;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@SpringBootApplication
public class CommunityApplication {

	public static void main(String[] args) {
		SpringApplication.run(CommunityApplication.class, args);
	}

	@GetMapping
	public String HelloWorld(){
		return "Hello World!";
	}
}
```
## 2.3. 얼티미트 버전에서 스프링 부트 사용하기    


***
# 3. 그레이들 설치 및 빌드하기   
**메이븐 설정 파일인 ```pom.xml```은 XML 기반으로 작성되어 있어서 동적인 행위에 제약이 있습니다.**                
그래서 대안으로 나온 그루비 기반의 그레들이 주목받고 있습니다.        
      
그레이들은 앤트로부터 기본적인 빌드 도구의 기능을, 메이븐으로 의존 라이브러리 관리 기능을 차용했습니다.              
멀티 프로젝트 구성 시에는 메이븐처럼 상속 구조가 아닌 설정 주입 방식을 사용하여 훨씬 유연하게 빌드 환경을 구성할 수 있습니다.       
      
## 3.1. 그레이들 래퍼    
그레이들 메인 홈페이지에 접속하여 각각의 OS 환경에 맞게 그레이들을 다운로드 설치합니다.   
   
https://gradle.org/install/
    
          
**그레이들 설정 관련 기본 구조**          
```
|---- gradle
|       ㄴ wrapper
|           |------- gradle-wrapper.jar      
|           ㄴ------ gradle-wrapper.properties   
|
|---- gradlew
|
|---- gradlew.bat
```
    
* gradlew : 리눅스 및 맥OS용 셸 스크립트        
* gradlew.bat : 윈도우용 배치 스크립트        
* gradle/wrapper/gradle-wrapper.jar : Wrapper JAR         
* gradle/wrapper/gradle-wrapper.properties : 그레이들 설정 정보 프로퍼티 파일(버전 정보 등)     
        
**참고로** 스프링 이니셜라이저로 프로젝트를 생성하면 해당 프로젝트에 그레이들이 자동으로 설치됩니다.               
왜냐하면 그레이들 래퍼 때문인데 위 그림의 구조는 그레이들 래퍼와 관련된 설정이며          
프로젝트 첫 설정 시 **그레이들 관련 빌드 설정을 자동으로 해주기 때문입니다.**         
따라서 그레이들 래퍼를 설치하여 깃과 같은 VCS에서 관리하면 공동 작업자들이 설치 및 버전 관리를 편리하게 할 수 있습니다.       
     
그레이들로 구성된 프로젝트를 새로운 그레이들 버전으로 변경할 수도 있습니다.      
```gradle-wrapper.properties```에서 distributionUrl 을 원하는 그레이들 버전으로 수정하면 됩니다.     
즉, 그레이들 버전을 업그레이드 하고 싶다면 그레이들 래퍼를 사용해서 간단하게 처리할 수 있습니다.      
         
맥OS 나 리눅스 사용자라면 gradlew 셸 스크립트를 실행하면 됩니다.      
```
$ ./gradlew wrapper --gradle-version 4.8.1
```    
만약 권한이 없다는 메시지가 출력 된다면 파일 권한을 바꾸면 됩니다.  
```
$ chmod 755 gradlew
```
그리고 그레이들 버전을 확인하고 싶다면 ```-v```를 이용해도 됩니다.   
```
$ ./gradlew -v
```
### 제가 공부하는 책에서는 ```그레이들 4.8.1``` 로 사용할 것입니다.    

## 3.2. 그레이들 멀티 프로젝트 구성하기       
그레이들 멀티 프로젝트를 활용하면 여러 프로젝트를 마치 하나의 프로젝트처럼 사용할 수 있습니다.(그럼 왜 사용해?)         
일반적으로 이 기능은 공통 코드를 하나의 프로젝트로 분리하고 이를 재사용할 때 운용합니다.(공통 코드를 따로 분리시키기 위해 사용)      

```
예를 들면 커뮤니티 서비스를 개발한다고 합시다.   
웹, API, 배치, 기타 프로젝트가 존재할 겁니다.   
네 프로젝트 모두에서 공통된 도메인이나 유틸리티를 사용할 겁니다.   
이를 멀티 프로젝트로 구성하여 한번에 처리 및 관리를 하기 위해서 사용을 하는 것입니다.
멀티 프로젝트로 구성하면 이러한 중복 코드를 제거할 수 있어 실수와 번거로움을 줄일 수 있습니다.

만약 멀티 프로젝트로 구성하지 않으면 도메인 칼럼이 추가되거나 변결되었을 때 모든 프로젝트를 일일이 수정해주어야 합니다.  
```
   
## 그럼 **도메인 관련 코드를 별도의 프로젝트로 분리하여 관리하는 멀티 프로젝트를 구성해보겠습니다.**     
### 3.2.1. ```setting.gradle``` 파일에 루트 프로젝트 추가 (```setting.gradle```파일은 그레이들 설정 파일입니다)  

**setting.gradle**
```gradle  
rootProject.name = 'demo'
```

### 3.2.1. 테스트로 사용할 ```demo-web``` 모듈과 공용으로 사용할 ```demo-domain``` 모듈을 생성
1. ```demo-web``` 모듈 생성  
      1. ```New -> Module```
      2. ```Gradle``` 선택한 뒤 ```Java``` 선택 후 Next
      3. ```Add as module to``` 에서 community 프로젝트를 선택한 다음,
      4. ```ArtifactId``` 에 ```demo-web``` 을 입력하고 Next 눌러 모듈 생성   
      5. 생성된 ```demo-web``` 모듈에는 ```build.gradle``` 파일만 존재한다.  
      6. 아래와 같이 기본 패키지 경로 (디렉토리)를 만들어주자       
      * ```src/main/java/com/demo``` : 자바 소스 디렉토리  
      * ```src/test/java/com/demo``` : 스프링 부트 테스트 코드 디렉토리 
      * ```src/main/resources/static``` : static한 파일(css,image,js)의 디폴트 경로    
      * ```src/main/resources/templates``` : thymeleaf, freemarker 및 기타 서버 사이드 템플릿 파일의 경로     
         
그리고 이렇게 Module 을 생성하면 루트 프로젝트의 ```setting.gradle```에 생성된 모듈명이 인클루드 됩니다.     
```
rootProject.name = 'demo'
include 'demo-web'
```
    
2. ```demo-web``` 과 같은 방식으로 ```demo-domain``` 모듈도 생성합니다.   
      1. ```New -> Module```
      2. ```Gradle``` 선택한 뒤 ```Java``` 선택 후 Next
      3. ```Add as module to``` 에서 community 프로젝트를 선택한 다음,
      4. ```ArtifactId``` 에 ```demo-domain``` 을 입력하고 Next 눌러 모듈 생성   
      5. 생성된 ```demo-domain``` 모듈에는 ```build.gradle``` 파일만 존재한다.  
      6. 아래와 같이 기본 패키지 경로 (디렉토리)를 만들어주자       
      * ```src/main/java/com/demo``` : 자바 소스 디렉토리  
      * ```src/test/java/com/demo``` : 스프링 부트 테스트 코드 디렉토리 
       
```demo-domain```은 리소스 파일을 갖고 있지 않기 때문에 리소스 패키지를 따로 생성하지 않았습니다.      
    
동일한 방식으로 다양한 멀티 프로젝트를 더 많이 구성할 수 있습니다.   
멀티프로젝트를 구성하면 코드 재사용이 높아지고 한 서비스에 관련된 여러 프로젝트를 마치 하나의 통합 프로젝트처럼 관리할 수 있습니다.  
     

***
# 4. 환경 프로퍼티 파일 설정하기   
스프링 부트 프로퍼티 파일은 설정 관련 및 기타 정적인 값을 키값 형식으로 관리합니다.       
이 파일을 사용하면 기존 스프링 프레임워크의 복잡한 XML 설정을 파일 하나로 대체할 수 있습니다.   
   
**예시**      
```
server.port: 80   
```
   
기존에는 Properties 파일을 많이 사용했지만 **최근에는 표현의 한계로 YAML 파일을 더 많이 사용합니다.**   
```src/main/resources/application.yml```을 생성하고 다음과 같이 변경합니다.   

**application.yml**
```yml
server:
      port: 80
```
프로퍼티 설정값의 깊이에 따라 들여쓰기를 해서 걔층 구조를 훨씬 쉽게 파악할 수 있습니다.   
      
YAML을 설정하려면 SnakeYAML 라이브러리를 포함해야 하지만 스프링 부트 스타터에 기본적으로 내장되어 있다.    
즉, 스프링 부트 스타터를 사용하면 별도의 설정 없이 사용할 수 있다.       
그리고 ```application.properties``` 와 ```application.yml```이 동시에 존재하면 ```.yml``` 파일만 실행된다.       
그래도 ```.yml``` 파일로만 작업을 할 것이니 ```src/main/resources/applicaion.properties```는 삭제해주자      
   
```
원래 YAML은 'YAML은 마크업 언어가 아니다 - YAML Ain't Markup Language' 라는 뜻으로   
핵심이 문서 마크업이 아닌 데이터 중심에 있다는 것을 보여줍니다.   
그에 맞게 가독성이 좋으며 문법이 이해하기 수월하도록 작성된 언어입니다.   
```

## 4.1. 프로파일에 따른 환경 구성 분리   
실제 서비스에서는 로컬 DB, 개발 DB, 운영 DB의 설정값이 모두 다릅니다.   
이런 경우를 대비해 프로파일에 따라 프로퍼티를 다르게 설정해야 합니다.   
   
**YAML** 파일에서 프로퍼티 설정을 구분하는 방법은 간단합니다.   
다음과 같이 ```---``` 을 기준으로 설정값을 나눕니다.   
    
**application.yml**
```yml   
server:
  port: 80
---
spring: 
  profiles: local
server:
  port: 8080
---
spring:
  profiles: dev
server:
  port: 8081
---
spring:
  profiles: real
server:
  port: 8082
---
```
최상단에 ```server.port``` 프로퍼티값을 80으로 설정한 부분은 프로파일과는 상관없이 디폴트로 정의되는 영역입니다.       
**또다른 방법으로 ```application-[profile].yml```을 이용하는 겁니다.**                    
     
```[profile]```에 원하는 프로파일 값으로 YAML 파일을 추가하면             
애플리케이션 실행 시 ```application-[profile].yml```에서 지정한 프로파일값을 바탕으로 실행됩니다.          
즉, **호출한 ```yml```이 우선순위가 되고 이외에 존재하는 프로퍼티들도 ```applcaiton.yml```순서에 따라 설정됩니다.**            
   
### 이번에는 프로파일값을 적용하여 애플리케이션을 실행하는 방법을 알아보겠습니다.   
```local```, ```dev```, ```real```과 같이 각각의 프로파일값을 따로 지정하여 애플리케이션을 실행한다 가정합니다.   
스프링 부트 프로젝트는 JAR 파일로 빌드하기에 서버에서 직접 간단한 명렬으로 실행할 수 있습니다.    
   
아래 와 같이 실행하여 프로파일 값을 활성화할 수 있습니다.

```
$ java -jar -D spring.profiles.active=dev
```
```
java -Dspring.profiles.active=dev -jar [jar파일명].jar
java -jar [jar파일명].jar --spring.profiles.active=dev
```
출처: https://freestrokes.tistory.com/106 [FREESTROKES DEVLOG]     
      
      
인텔리제이는 스프링 부트 실행 플러그인을 따로 사용하기 때문에       
```Edit Configurations``` 버튼을 눌러 ```Run/Debug configurations``` 창을 실행하고     
스프링 부트 플러그인의 프로파일 값을 할당하면 됩니다.      

**얼티메이트와 커뮤니티는 Application 타입이 달라서 환경이 다르다**    
커뮤니티를 기준으로 ```VM options:```에 ```-Dspring.profiles.active=dev```로 설정해주면된다.   
   
[사진]   
    

## 4.2. YAML 파일 매핑하기  
YAML 파일을 사용하면 깊이에 따라 관계를 구분 짓기 때문에      
```List```, ```Set```, ```Map``` 등 다양한 바인딩형 매핑이 훨씬 편합니다.     
      
YAML 파일에 있는 데이터를 가져와서 사용하는 방법은 다양합니다. (properties의 매핑 방법도 같습니다.)          
유용하게 사용되는 ```@Value```와 ```@ConfigurationProperties``` 어노테이션을 비교해보겠습니다.      

```
어노테이션이란 클래스, 메소드, 필드 등 프로그램 요소에 정보를 제공하는 기법입니다.   
타깃 요소를 제어/관리/명시하는 등의 다양한 기능을 할 수 있습니다.   
```

[사진]  

각 기능은 다음과 같습니다.  
